trigger:
- '*'

pool:
  vmImage: ubuntu-latest
  demands:
  - npm

variables:
  buildConfiguration: 'Release'
  wwwrootDirectory: Tailspin.SpaceGame.Web/wwwroot
  dotnetSdkVersion: 5.x
steps:
  - task: UseDotNet@2
    displayName: Use .Net SDK $(dotnetSdkVersion)
    inputs:
      packageType: sdk
      version: $(dotnetSdkVersion)

  - task: Npm@1
    displayName:  Run Npm install
    inputs:
      verbose: false 
  
  - script: ./node_modules/.bin/node-sass $(wwwrootDirectory) --output $(wwwrootDirectory)
    displayName: Compile Sass assets 
  
  - task: gulp@1
    displayName: Run gulp Tasks
  
  - script: echo "$(Build.DefinitionName), $(Build.BuildId), $(Build.BuildNumber)" > buildinfo.txt
    displayName: Write build info 
    workingDirectory: $(wwwrootDirectory)
  
  - task: DotNetCoreCLI@2
    displayName: Restore project dependencies
    inputs:
      command: restore
      projects: '**/*.csproj'
  
  - template: templates/build.yml
    parameters:
      buildConfiguration: Debug
  
  - template: templates/build.yml
    parameters: 
      buildConfiguration: Release
      
  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact: drop'
    condition: succeeded()